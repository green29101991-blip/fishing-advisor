<!DOCTYPE html>
<html>
<head>
    <title>üé£ –†—ã–±–∞—Ü–∫–∏–π –ø–æ–º–æ—â–Ω–∏–∫</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: #333;
        }
        .container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 30px;
            width: 90%;
            max-width: 800px;
            text-align: center;
        }
        h1, h2 {
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            text-align: left;
        }
        .form-group label {
            min-width: 40px;
            text-align: center;
            font-size: 20px;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .form-group select,
        .form-group input[type="date"] {
            flex: 1;
            padding: 12px 40px 12px 12px; /* ‚Üê –∫–ª—é—á–µ–≤–∞—è —Å—Ç—Ä–æ–∫–∞: 40px —Å–ø—Ä–∞–≤–∞ */
            border: 2px solid #3498db;
            border-radius: 8px;
            background: #f0f8ff;
            font-size: 16px;
            box-sizing: border-box;
        }

        button {
            background: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
            margin-bottom: 20px;
        }
        button:hover {
            background: #2980b9;
        }
        .toggle-button {
            background: #2ecc71;
            margin-top: 10px;
            margin-bottom: 20px;
        }
        .toggle-button:hover {
            background: #27ae60;
        }
        .short-advice {
            background: #f0f8ff;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: left;
        }
        .period-block {
            background: #f0f8ff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: left;
            display: none;
        }
        .period-block.visible {
            display: block;
        }
        .period-name {
            width: 100%;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 18px;
        }
        .period-details {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .period-detail {
            min-width: 45%;
            margin-bottom: 5px;
        }
        .period-advice {
            width: 100%;
            margin-top: 10px;
            font-weight: bold;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé£ –†—ã–±–∞—Ü–∫–∏–π –ø–æ–º–æ—â–Ω–∏–∫</h1>

        <form action="/" method="get">
            <div class="form-group">
                <label for="city">üèô</label>
                <select id="city" name="city" required>
                    <option value="Moscow" {% if city == 'Moscow' %}selected{% endif %}>–ú–æ—Å–∫–≤–∞</option>
                    <option value="Saint Petersburg" {% if city == 'Saint Petersburg' %}selected{% endif %}>–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥</option>
                    <option value="Kazan" {% if city == 'Kazan' %}selected{% endif %}>–ö–∞–∑–∞–Ω—å</option>
                    <option value="Novosibirsk" {% if city == 'Novosibirsk' %}selected{% endif %}>–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫</option>
                    <option value="Ekaterinburg" {% if city == 'Ekaterinburg' %}selected{% endif %}>–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥</option>
                    <option value="Rostov-on-Don" {% if city == 'Rostov-on-Don' %}selected{% endif %}>–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É</option>
                    <option value="Sochi" {% if city == 'Sochi' %}selected{% endif %}>–°–æ—á–∏</option>
                    <option value="Krasnodar" {% if city == 'Krasnodar' %}selected{% endif %}>–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä</option>
                    <option value="Vladivostok" {% if city == 'Vladivostok' %}selected{% endif %}>–í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫</option>
                    <option value="Kaliningrad" {% if city == 'Kaliningrad' %}selected{% endif %}>–ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥</option>
                </select>
            </div>

            <div class="form-group">
                <label for="date">üìÖ</label>
                <input type="date" id="date" name="date" required>
            </div>

            <button type="submit">–ü–æ–ª—É—á–∏—Ç—å —Å–æ–≤–µ—Ç</button>
        </form>

        {% if city %}
            <p>üìç –ü—Ä–æ–≥–Ω–æ–∑ –¥–ª—è: <strong>{% if city == 'Moscow' %}–ú–æ—Å–∫–≤–∞{% elif city == 'Saint Petersburg' %}–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥{% elif city == 'Kazan' %}–ö–∞–∑–∞–Ω—å{% elif city == 'Novosibirsk' %}–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫{% elif city == 'Ekaterinburg' %}–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥{% elif city == 'Rostov-on-Don' %}–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É{% elif city == 'Sochi' %}–°–æ—á–∏{% elif city == 'Krasnodar' %}–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä{% elif city == 'Vladivostok' %}–í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫{% elif city == 'Kaliningrad' %}–ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥{% else %}{{ city }}{% endif %}</strong></p>
        {% endif %}

        {% if advice_blocks %}
            <h2>üìä –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ {{ date }}</h2>

            <div class="short-advice">
                <h3>üå¶ –ö—Ä–∞—Ç–∫–∏–π –ø—Ä–æ–≥–Ω–æ–∑:</h3>
                <p>üåô –§–∞–∑–∞ –õ—É–Ω—ã: {{ advice_blocks[0].moon_phase }}</p>

                {% set total_temp = namespace(value=0) %}
                {% for block in advice_blocks %}
                    {% set total_temp.value = total_temp.value + block.temp.replace('¬∞C', '')|float %}
                {% endfor %}
                <p>üå° –°—Ä–µ–¥–Ω—è—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: ~{{ (total_temp.value / advice_blocks|length)|round(1) }}¬∞C</p>

                {% set total_wind = namespace(value=0) %}
                {% for block in advice_blocks %}
                    {% set total_wind.value = total_wind.value + block.wind.replace(' –º/—Å', '')|float %}
                {% endfor %}
                <p>üí® –°—Ä–µ–¥–Ω–∏–π –≤–µ—Ç–µ—Ä: ~{{ (total_wind.value / advice_blocks|length)|round(1) }} –º/—Å</p>

                {% set total_rain = namespace(value=0) %}
                {% for block in advice_blocks %}
                    {% set total_rain.value = total_rain.value + block.rain.replace(' –º–º', '')|float %}
                {% endfor %}
                <p>üåß –û—Å–∞–¥–∫–∏: ~{{ total_rain.value|round(1) }} –º–º</p>

                <p>üìä <strong>–°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞ –∫–ª—ë–≤–∞: {{ avg_score|round(1) }}/10</strong></p>
                <p style="color: {% if avg_score >= 9 %}#2ecc71{% elif avg_score >= 7 %}#27ae60{% elif avg_score >= 5 %}#3498db{% elif avg_score >= 3 %}#f39c12{% else %}#e74c3c{% endif %}; font-weight: bold;">
                    {{ summary_advice }}
                </p>
            </div>

            <button id="toggleDetails" class="toggle-button">üìä –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω—ã–π –ø—Ä–æ–≥–Ω–æ–∑</button>

            {% for block in advice_blocks %}
                <div class="period-block">
                    <div class="period-name">{{ block.period }}</div>
                    <div class="period-details">
                        <div class="period-detail">üåô –§–∞–∑–∞ –õ—É–Ω—ã: {{ block.moon_phase }}</div>
                        <div class="period-detail">üå° –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: {{ block.temp }}</div>
                        <div class="period-detail">üí® –í–µ—Ç–µ—Ä: {{ block.wind }}</div>
                        <div class="period-detail">üåß –û—Å–∞–¥–∫–∏: {{ block.rain }}</div>
                        <div class="period-detail">üíß –í–ª–∞–∂–Ω–æ—Å—Ç—å: {{ block.humidity }}</div>
                    </div>
                    <div class="period-advice" style="color: {% if block.score >= 9 %}#2ecc71{% elif block.score >= 7 %}#27ae60{% elif block.score >= 5 %}#3498db{% elif block.score >= 3 %}#f39c12{% else %}#e74c3c{% endif %};">
                        {{ block.advice }} (–û—Ü–µ–Ω–∫–∞: {{ block.score }}/10)
                    </div>
                </div>
            {% endfor %}
        {% endif %}
    </div>

    <script>
        const serverDate = "{{ date }}";
        const dateInput = document.getElementById('date');
        if (serverDate && serverDate !== "None" && /^\d{4}-\d{2}-\d{2}$/.test(serverDate)) {
            dateInput.value = serverDate;
        }

        const citySelect = document.getElementById('city');
        citySelect.addEventListener('change', function() {
            dateInput.value = '';
            dateInput.setAttribute('required', 'required');
        });

        const toggleButton = document.getElementById('toggleDetails');
        const periodBlocks = document.querySelectorAll('.period-block');

        if (toggleButton && periodBlocks.length > 0) {
            toggleButton.addEventListener('click', function() {
                const isVisible = periodBlocks[0].classList.contains('visible');
                if (isVisible) {
                    periodBlocks.forEach(block => block.classList.remove('visible'));
                    toggleButton.textContent = 'üìä –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω—ã–π –ø—Ä–æ–≥–Ω–æ–∑';
                } else {
                    periodBlocks.forEach(block => block.classList.add('visible'));
                    toggleButton.textContent = 'üìå –°–∫—Ä—ã—Ç—å –ø–æ–¥—Ä–æ–±–Ω—ã–π –ø—Ä–æ–≥–Ω–æ–∑';
                }
            });
        }
    </script>
</body>
</html>